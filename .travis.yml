language: generic
dist: trusty
group: edge
sudo: true
cache: bundler
env:
  global:
  - PATH="/opt/chefdk/bin:/opt/chefdk/embedded/bin:/opt/chef/bin:$PATH"
  - CHEF_COOKBOOK_PATH="$TRAVIS_BUILD_DIR/.git::cookbooks https://github.com/travis-ci/travis-cookbooks.git::cookbooks@master,ci_environment@precise-stable,worker_host@precise-stable"
  - PACKER_TEMPLATES_PATH="$TRAVIS_BUILD_DIR/.git::"
addons:
  apt:
    sources:
    - chef-stable-trusty
    packages:
    - chefdk
install:
- unset GEM_PATH
- bundle install --path vendor/bundle
- ./bin/packer-build-install
script:
- make hackcheck
- make
- git diff --exit-code
- git diff --cached --exit-code
- bundle exec rspec
- make test
- if [[ $TRAVIS_PULL_REQUEST = false ]] ; then
    ./bin/trigger-downstreams ;
  else
    echo '✮✮✮ Skip trigger-downstreams for pull request builds ✮✮✮' ;
  fi
