---
description: Travis play build env template
variables:
  docker_login_email: "{{ env `DOCKER_LOGIN_EMAIL` }}"
  docker_login_password: "{{ env `DOCKER_LOGIN_PASSWORD` }}"
  docker_login_server: "{{ env `DOCKER_LOGIN_SERVER` }}"
  docker_login_username: "{{ env `DOCKER_LOGIN_USERNAME` }}"
  docker_tag: "packer-{{ timestamp }}"
  gce_account_file: "{{ env `GCE_ACCOUNT_FILE` }}"
  gce_image_name: "travis-ci-connie-trusty-{{ timestamp }}"
  gce_project_id: "{{ env `GCE_PROJECT_ID` }}"
  gcr_auth_token: "{{ env `GCR_AUTH_TOKEN` }}"
  gcr_login_server: "{{ env `GCR_LOGIN_SERVER` }}"
  job_board_images_url: "{{ env `JOB_BOARD_IMAGES_URL` }}"
  quay_docker_login_email: "{{ env `QUAY_DOCKER_LOGIN_EMAIL` }}"
  quay_docker_login_password: "{{ env `QUAY_DOCKER_LOGIN_PASSWORD` }}"
  quay_docker_login_server: "{{ env `QUAY_DOCKER_LOGIN_SERVER` }}"
  quay_docker_login_username: "{{ env `QUAY_DOCKER_LOGIN_USERNAME` }}"
  travis_cookbooks_branch: "{{ env `TRAVIS_COOKBOOKS_BRANCH` }}"
  travis_cookbooks_edge_branch: master
  travis_cookbooks_sha: "{{ env `TRAVIS_COOKBOOKS_SHA` }}"
builders:
- type: docker
  name: docker
  ssh_pty: true
  image: "ubuntu:14.04"
  run_command:
  - "-d"
  - "-i"
  - "-t"
  - "--privileged=true"
  - "{{.Image}}"
  - "/sbin/init"
  commit: true
provisioners:
- type: file
  source: tmp/git-meta
  destination: /var/tmp/git-meta
- type: shell
  scripts:
  - packer-scripts/packer-env-dump
  execute_command: "{{ .Vars }} exec sudo -E -S bash '{{ .Path }}'"
post-processors:
-
  - type: docker-tag
    repository: quay.io/travisci/play
    tag: "{{ user `docker_tag` }}"
    only:
    - docker
  - type: docker-push
    login: true
    login_email: "{{ user `quay_docker_login_email` }}"
    login_password: "{{ user `quay_docker_login_password` }}"
    login_username: "{{ user `quay_docker_login_username` }}"
    login_server: "{{ user `quay_docker_login_server` }}"
    only:
    - docker
